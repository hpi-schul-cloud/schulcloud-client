{{#extend "administration/administration"}}
{{#content "styles" mode="append"}}
<link rel="stylesheet" href="/styles/administration/school.css" />
{{/content}}

{{#content "scripts" mode="append"}}
<script src="/scripts/administration/school.js" type="text/javascript" defer></script>
{{/content}}

{{#content "page" mode="prepend"}}
<div class="route-administration">
    <section class="section-school section-default">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-12 no-padding">
                    <!-- Admin View -->
                    {{#userHasPermission 'ADMIN_VIEW'}}
                    <h2 class="h4">Schule</h4>

                    <form action="/administration/schools/{{../currentSchool}}" method="post" class="edit-form-school">
                        <input type="hidden" name="_method" value="patch" />

                        <div class="form-group">
                            <label>Name der Schule</label>
                            <input value="{{../school.name}}" type="text" class="form-control" name="name" placeholder="Einhorn Gymnasium"
                                {{#if ../schoolUsesLdap}} readonly{{/if}} {{#if ../isExpertSchool}} readonly{{/if}}
                                required />
                        </div>

                        <div class="form-group">
                            <label>Schullogo hochladen</label><br />
                            <input type="hidden" name="logo_dataUrl">
                            <input type="file" id="logo-input">
                            <label for="logo-input" class="btn btn-secondary">Datei auswählen</label>
                            <span id="logo-filename">Keine Datei ausgewählt</span>
                            <img id="preview-logo" src="">
                            <canvas id="logo-canvas" width="35" height="35" class="hidden"></canvas>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" name="rocketchat" value="true" {{#inArray "rocketChat" ../school.features}}checked{{/inArray}}>
                                Chatfunktion aktivieren
                                <p class="text-muted">Durch Ihren Klick auf „Chatfunktion aktivieren“ bestätigen Sie, dass Sie weisungsberechtigter Schul-Administrator und befugt sind,
                                die Chat-Funktion für Ihre Schule freizuschalten. Ihr Klick gilt insofern als Weisung der Schule gegenüber dem HPI.</p>
                            </label>
                        </div>

                        {{#if ../school.fileStorageType}}
                        <div class="form-group">
                            <label>Cloud-Storage Anbieter</label>
                            <select name="fileStorageType" type="text">
                                {{#each ../provider}}
                                <option value="{{this.value}}" {{#if this.selected}} selected{{/if}}>{{this.label}} </option>
                                    {{/each}} </select> </div> {{/if}} <button type="submit" class="btn btn-primary btn-submit">Speichern</button>
                    </form>

                    {{#if ../school.fileStorageType}}
                    <div style="padding-top: 20px">
                        <label>Genutzter Datei-Speicherplatz in der Cloud</label>
                        <p>Derzeit bezieht Ihre Schule {{writeFileSizePretty ../totalStorage.totalSize}}.</p>
                    </div>
                    {{/if}}
                    {{/userHasPermission}}
                </div>
            </div>
        </div>
    </section>
    {{#unless school.fileStorageType}}
    <section class="section-school section-default">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-12 no-padding">
                    <form action="/administration/schools/{{currentSchool}}/bucket" method="post" class="edit-form-school">

                        <div class="form-group">
                            <label>Cloud-Storage Anbieter</label>
                            <select name="fileStorageType" type="text">
                                <option disabled="disabled" selected="selected">Anbieter auswählen</option>
                                {{#each provider}}
                                <option value="{{this.value}}" {{#if this.selected}} selected{{/if}}>{{this.label}} </option>
                                    {{/each}} </select> </div> <button type="submit" class="btn btn-primary btn-submit">Speichern</button>

                    </form>
                </div>
            </div>
        </div>
    </section>
    {{/unless}}
    <section class="section-school section-default">
        <h2 class="h4">Authentifizierung</h2>
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-12 no-padding">
                    {{> "lib/components/table" head=systemsHead body=systemsBody}}
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12 no-padding">
                    <form action="/administration/systems/ldap/add" method="POST">
                        <button type="submit" class="btn btn-primary btn-add-modal ">
                            System hinzufügen
                        </button>
                        {{#if ldapAddable}}
                        <button type="submit" class="btn btn-primary">
                            LDAP System hinzufügen
                        </button>
                        {{/if}}
                    </form>
                </div>
            </div>
        </div>

        {{#embed "lib/components/modal-form" method="patch" class="edit-modal" collapseId=1}}
        {{#content "fields"}}
        {{> "administration/forms/form-systems"}}
        {{/content}}
        {{/embed}}

        {{#embed "lib/components/modal-form" action="/administration/systems/" method="post" class="add-modal"
        collapseId=2}}
        {{#content "fields"}}
        {{> "administration/forms/form-systems"}}
        {{/content}}
        {{/embed}}

        {{#embed "lib/components/modal-form" body=systemsBody method="delete" class="delete-modal"}}
        {{#content "fields"}}
        {{> "administration/forms/form-delete-alias"}}
        {{/content}}
        {{/embed}}
    </section>

    <section class="section-school section-default">
        <h2 class="h4">RSS-Feeds</h2>
        <div class="container-fluid">
            <div class="row">
                {{#if hasRSS}}
                <div class="col-sm-12 no-padding">
                    {{> "lib/components/table" head=rssHead body=rssBody}}
                </div>
                {{else}}
                <p>Es sind noch keine RSS-Feeds hinterlegt.</p>
                {{/if}}
            </div>
            <div class="row">
                <div class="col-sm-12 no-padding">
                    <button type="submit" class="btn btn-primary btn-add-modal--rss">
                        RSS-Feed hinzufügen
                    </button>
                </div>
            </div>
        </div>

        {{#embed "lib/components/modal-form" action="/administration/rss/" method="post" class="add-modal--rss"
        collapseId=3}}
        {{#content "fields"}}
        {{> "administration/forms/form-rss"}}
        {{/content}}
        {{/embed}}

        {{#embed "lib/components/modal-form" body=rssBody method="delete" class="delete-modal--rss"}}
        {{#content "fields"}}
        {{> "administration/forms/form-delete-rss"}}
        {{/content}}
        {{/embed}}

    </section>
</div>
{{/content}}
{{/extend}}